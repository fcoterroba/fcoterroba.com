---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getLanguageFromURL } from '../../utils/i18n';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  return allPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const currentLang = getLanguageFromURL(Astro.url);
const { Content, headings } = await post.render();

const allPosts = await getCollection('blog');
const baseSlug = post.slug.replace(/-es$|-en$/, '');
const equivalentPost = allPosts.find(p => {
  const otherBaseSlug = (p as any).slug.replace(/-es$|-en$/, '');
  return otherBaseSlug === baseSlug && p.data.lang !== post.data.lang;
});
---

<BaseLayout 
  title={`${post.data.title} - fcoterroba blog`}
  description={post.data.description}
  lang={post.data.lang}
>
  <div>
    <section class="pt-32 pb-16 theme-bg">
      <div class="max-w-5xl mx-auto px-8 lg:px-12">
        <div class="text-center mb-16">
          <div class="flex items-center justify-center gap-4 mb-8">
            <span class="text-sm theme-text-60 font-medium">{post.data.readTime}</span>
            <span class="text-sm theme-text-60">•</span>
            <span class="px-6 py-3 bg-brand-green text-white text-sm font-semibold rounded-full shadow-lg">
              {post.data.category}
            </span>
            <span class="text-sm theme-text-60">•</span>
            <span class="text-sm theme-text-60">{new Date(post.data.date).toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' })}</span>
          </div>
          <h1 class="text-5xl lg:text-7xl font-bold theme-text mb-8 leading-tight">
            {post.data.title}
          </h1>
          <p class="text-2xl theme-text-70 leading-relaxed max-w-4xl mx-auto">
            {post.data.description}
          </p>
        </div>
      </div>
    </section>

    <article class="py-16 bg-gradient-to-br from-brand-light/5 to-brand-green/5">
      <div class="max-w-7xl mx-auto px-8 lg:px-12">
        <div class="bg-white/95 dark:bg-gray-900/95 rounded-3xl p-8 lg:p-12 shadow-2xl backdrop-blur-sm border border-gray-200 dark:border-gray-700">
          <div class="prose-content" id="blog-content">
            <Content />
          </div>
        </div>
      </div>
    </article>

    <section class="py-8 theme-bg">
      <div class="max-w-7xl mx-auto px-8 lg:px-12">
        <div class="flex flex-wrap gap-3 justify-center">
          {post.data.tags.map((tag: string) => (
            <span class="px-4 py-2 bg-brand-green/10 text-brand-green text-sm font-medium rounded-full border border-brand-green/20">
              #{tag}
            </span>
          ))}
        </div>
      </div>
    </section>

    <section class="py-12 theme-bg">
      <div class="max-w-7xl mx-auto px-8 lg:px-12 text-center">
        <a 
          href="/blog"
          class="inline-flex items-center gap-3 px-8 py-4 bg-brand-green text-white rounded-3xl font-semibold hover:bg-brand-green/90 transition-all duration-300 hover:scale-105 shadow-xl hover:shadow-2xl"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          <span>{post.data.lang === 'es' ? 'volver al blog' : 'back to blog'}</span>
        </a>
      </div>
    </section>
  </div>

  <style>
    [data-theme="dark"] * {
      color: #ffffff !important;
    }
    
    [data-theme="dark"] .theme-text {
      color: #ffffff !important;
    }
    
    [data-theme="dark"] .theme-text-70 {
      color: #ffffff !important;
    }
    
    [data-theme="dark"] .theme-text-60 {
      color: rgba(255, 255, 255, 0.8) !important;
    }

    .prose-content h1 {
      font-size: 3rem !important;
      font-weight: 700 !important;
      color: #111827 !important;
      margin-top: 3rem !important;
      margin-bottom: 2rem !important;
      line-height: 1.1 !important;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    [data-theme="dark"] .prose-content h1 {
      color: #ffffff !important;
    }

    .prose-content h2 {
      font-size: 2.25rem !important;
      font-weight: 700 !important;
      color: #10b981 !important;
      margin-top: 3rem !important;
      margin-bottom: 1.5rem !important;
      line-height: 1.1 !important;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .prose-content h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 4px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 2px;
    }

    .prose-content h3 {
      font-size: 1.875rem !important;
      font-weight: 600 !important;
      color: #10b981 !important;
      margin-top: 2.5rem !important;
      margin-bottom: 1rem !important;
      line-height: 1.1 !important;
      position: relative;
      padding-left: 1rem;
    }

    .prose-content h3::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 60%;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 2px;
    }

    .prose-content h4 {
      font-size: 1.5rem !important;
      font-weight: 600 !important;
      color: #111827 !important;
      margin-top: 2rem !important;
      margin-bottom: 1rem !important;
      line-height: 1.1 !important;
    }

    [data-theme="dark"] .prose-content h4 {
      color: #ffffff !important;
    }

    .prose-content p {
      font-size: 1.25rem !important;
      line-height: 1.8 !important;
      margin-bottom: 2rem !important;
      color: #374151 !important;
    }

    [data-theme="dark"] .prose-content p {
      color: #d1d5db !important;
    }

    .prose-content ul, .prose-content ol {
      margin-bottom: 2rem !important;
      padding-left: 2rem !important;
    }

    .prose-content li {
      font-size: 1.25rem !important;
      line-height: 1.8 !important;
      margin-bottom: 0.75rem !important;
      color: #374151 !important;
      position: relative;
    }

    [data-theme="dark"] .prose-content li {
      color: #d1d5db !important;
    }

    .prose-content ul li::marker {
      color: #10b981 !important;
      font-weight: bold !important;
    }

    .prose-content strong {
      font-weight: 700 !important;
      color: #10b981 !important;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .prose-content em {
      font-style: italic !important;
      color: #6b7280 !important;
    }

    [data-theme="dark"] .prose-content em {
      color: #9ca3af !important;
    }

    .prose-content blockquote {
      border-left: 4px solid #10b981 !important;
      padding-left: 2rem !important;
      padding-top: 1.5rem !important;
      padding-bottom: 1.5rem !important;
      margin: 2.5rem 0 !important;
      font-style: italic !important;
      background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%) !important;
      border-radius: 0 1rem 1rem 0 !important;
      font-size: 1.25rem !important;
      line-height: 1.8 !important;
      position: relative;
    }

    .prose-content blockquote::before {
      content: '"';
      position: absolute;
      top: -10px;
      left: 20px;
      font-size: 4rem;
      color: #10b981;
      opacity: 0.3;
      font-family: serif;
    }

    .prose-content code {
      background-color: rgba(16, 185, 129, 0.15) !important;
      color: #10b981 !important;
      padding: 0.75rem 1rem !important;
      border-radius: 0.375rem !important;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace !important;
      font-size: 1.125rem !important;
      font-weight: 500 !important;
      border: 1px solid rgba(16, 185, 129, 0.2) !important;
    }

    .prose-content pre {
      background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%) !important;
      padding: 2rem !important;
      border-radius: 1rem !important;
      overflow-x: auto !important;
      margin: 2.5rem 0 !important;
      border: 1px solid rgba(16, 185, 129, 0.2) !important;
      position: relative;
    }

    .prose-content pre::before {
      content: 'code';
      position: absolute;
      top: 10px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .prose-content pre code {
      background: transparent !important;
      padding: 0 !important;
      color: #374151 !important;
      font-size: 1.125rem !important;
      border: none !important;
    }

    [data-theme="dark"] .prose-content pre code {
      color: #d1d5db !important;
    }

    .prose-content a {
      color: #10b981 !important;
      text-decoration: underline !important;
      font-weight: 500 !important;
      transition: color 0.3s ease !important;
      text-decoration-color: #10b981 !important;
      text-underline-offset: 4px !important;
    }

    .prose-content a:hover {
      color: #059669 !important;
      text-decoration-color: #059669 !important;
    }

    .prose-content img {
      border-radius: 1rem !important;
      margin: 2.5rem 0 !important;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
      border: 1px solid rgba(16, 185, 129, 0.1) !important;
    }

    .prose-content hr {
      margin: 3rem 0 !important;
      border: 0 !important;
      height: 2px !important;
      background: linear-gradient(90deg, transparent 0%, #10b981 50%, transparent 100%) !important;
    }

    .transition-all {
      transition: all 0.3s ease;
    }

    .duration-300 {
      transition-duration: 300ms;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const content = document.getElementById('blog-content');
      if (!content) return;

      const h1Elements = content.querySelectorAll('h1');
      h1Elements.forEach(h1 => {
        h1.style.fontSize = '3rem';
        h1.style.fontWeight = '700';
        h1.style.color = '#111827';
        h1.style.marginTop = '3rem';
        h1.style.marginBottom = '2rem';
        h1.style.lineHeight = '1.1';
        h1.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        h1.style.webkitBackgroundClip = 'text';
        h1.style.webkitTextFillColor = 'transparent';
        h1.style.backgroundClip = 'text';
      });

      const h2Elements = content.querySelectorAll('h2');
      h2Elements.forEach(h2 => {
        h2.style.fontSize = '2.25rem';
        h2.style.fontWeight = '700';
        h2.style.color = '#10b981';
        h2.style.marginTop = '3rem';
        h2.style.marginBottom = '1.5rem';
        h2.style.lineHeight = '1.1';
        h2.style.position = 'relative';
        h2.style.paddingBottom = '0.5rem';
        
        const line = document.createElement('div');
        line.style.position = 'absolute';
        line.style.bottom = '0';
        line.style.left = '0';
        line.style.width = '60px';
        line.style.height = '4px';
        line.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        line.style.borderRadius = '2px';
        h2.appendChild(line);
      });

      const h3Elements = content.querySelectorAll('h3');
      h3Elements.forEach(h3 => {
        h3.style.fontSize = '1.875rem';
        h3.style.fontWeight = '600';
        h3.style.color = '#10b981';
        h3.style.marginTop = '2.5rem';
        h3.style.marginBottom = '1rem';
        h3.style.lineHeight = '1.1';
        h3.style.position = 'relative';
        h3.style.paddingLeft = '1rem';
        
        const bar = document.createElement('div');
        bar.style.position = 'absolute';
        bar.style.left = '0';
        bar.style.top = '50%';
        bar.style.transform = 'translateY(-50%)';
        bar.style.width = '4px';
        bar.style.height = '60%';
        bar.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        bar.style.borderRadius = '2px';
        h3.appendChild(bar);
      });

      const h4Elements = content.querySelectorAll('h4');
      h4Elements.forEach(h4 => {
        h4.style.fontSize = '1.5rem';
        h4.style.fontWeight = '600';
        h4.style.color = '#111827';
        h4.style.marginTop = '2rem';
        h4.style.marginBottom = '1rem';
        h4.style.lineHeight = '1.1';
      });

      const pElements = content.querySelectorAll('p');
      pElements.forEach(p => {
        p.style.fontSize = '1.25rem';
        p.style.lineHeight = '1.8';
        p.style.marginBottom = '2rem';
        p.style.color = '#374151';
      });

      const ulElements = content.querySelectorAll('ul');
      ulElements.forEach(ul => {
        ul.style.marginBottom = '2rem';
        ul.style.paddingLeft = '2rem';
      });

      const olElements = content.querySelectorAll('ol');
      olElements.forEach(ol => {
        ol.style.marginBottom = '2rem';
        ol.style.paddingLeft = '2rem';
      });

      const liElements = content.querySelectorAll('li');
      liElements.forEach(li => {
        li.style.fontSize = '1.25rem';
        li.style.lineHeight = '1.8';
        li.style.marginBottom = '0.75rem';
        li.style.color = '#374151';
      });

      const strongElements = content.querySelectorAll('strong');
      strongElements.forEach(strong => {
        strong.style.fontWeight = '700';
        strong.style.color = '#10b981';
        strong.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        strong.style.webkitBackgroundClip = 'text';
        strong.style.webkitTextFillColor = 'transparent';
        strong.style.backgroundClip = 'text';
      });

      const emElements = content.querySelectorAll('em');
      emElements.forEach(em => {
        em.style.fontStyle = 'italic';
        em.style.color = '#6b7280';
      });

      const codeElements = content.querySelectorAll('code');
      codeElements.forEach(code => {
        code.style.backgroundColor = 'rgba(16, 185, 129, 0.15)';
        code.style.color = '#10b981';
        code.style.padding = '0.75rem 1rem';
        code.style.borderRadius = '0.375rem';
        code.style.fontFamily = 'ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace';
        code.style.fontSize = '1.125rem';
        code.style.fontWeight = '500';
        code.style.border = '1px solid rgba(16, 185, 129, 0.2)';
      });

      const preElements = content.querySelectorAll('pre');
      preElements.forEach(pre => {
        pre.style.background = 'linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)';
        pre.style.padding = '2rem';
        pre.style.borderRadius = '1rem';
        pre.style.overflowX = 'auto';
        pre.style.margin = '2.5rem 0';
        pre.style.border = '1px solid rgba(16, 185, 129, 0.2)';
        pre.style.position = 'relative';
        
        const label = document.createElement('div');
        label.textContent = 'code';
        label.style.position = 'absolute';
        label.style.top = '10px';
        label.style.right = '20px';
        label.style.background = '#10b981';
        label.style.color = 'white';
        label.style.padding = '0.25rem 0.75rem';
        label.style.borderRadius = '0.375rem';
        label.style.fontSize = '0.75rem';
        label.style.fontWeight = '600';
        label.style.textTransform = 'uppercase';
        label.style.letterSpacing = '0.05em';
        pre.appendChild(label);
        
        const codeInPre = pre.querySelector('code');
        if (codeInPre) {
          codeInPre.style.background = 'transparent';
          codeInPre.style.padding = '0';
          codeInPre.style.color = '#374151';
          codeInPre.style.fontSize = '1.125rem';
          codeInPre.style.border = 'none';
        }
      });

      const aElements = content.querySelectorAll('a');
      aElements.forEach(a => {
        a.style.color = '#10b981';
        a.style.textDecoration = 'underline';
        a.style.fontWeight = '500';
        a.style.textDecorationColor = '#10b981';
        a.style.textUnderlineOffset = '4px';
      });

      const imgElements = content.querySelectorAll('img');
      imgElements.forEach(img => {
        img.style.borderRadius = '1rem';
        img.style.margin = '2.5rem 0';
        img.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.25)';
        img.style.border = '1px solid rgba(16, 185, 129, 0.1)';
      });

      const hrElements = content.querySelectorAll('hr');
      hrElements.forEach(hr => {
        hr.style.margin = '3rem 0';
        hr.style.border = '0';
        hr.style.height = '2px';
        hr.style.background = 'linear-gradient(90deg, transparent 0%, #10b981 50%, transparent 100%)';
      });

      const blockquoteElements = content.querySelectorAll('blockquote');
      blockquoteElements.forEach(blockquote => {
        blockquote.style.borderLeft = '4px solid #10b981';
        blockquote.style.paddingLeft = '2rem';
        blockquote.style.paddingTop = '1.5rem';
        blockquote.style.paddingBottom = '1.5rem';
        blockquote.style.margin = '2.5rem 0';
        blockquote.style.fontStyle = 'italic';
        blockquote.style.background = 'linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%)';
        blockquote.style.borderRadius = '0 1rem 1rem 0';
        blockquote.style.fontSize = '1.25rem';
        blockquote.style.lineHeight = '1.8';
        blockquote.style.position = 'relative';
        
        const quote = document.createElement('div');
        quote.textContent = '"';
        quote.style.position = 'absolute';
        quote.style.top = '-10px';
        quote.style.left = '20px';
        quote.style.fontSize = '4rem';
        quote.style.color = '#10b981';
        quote.style.opacity = '0.3';
        quote.style.fontFamily = 'serif';
        blockquote.appendChild(quote);
      });
    });
  </script>
</BaseLayout>
